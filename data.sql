-- Especies 
INSERT INTO Especies (nombre) VALUES
('Perro'), ('Gato'), ('Conejo'), ('Loro'), ('Tortuga'),
('Hámster'), ('Pez Betta'), ('Serpiente'), ('Hurón'), ('Iguana Verde');

-- Personas
INSERT INTO Personas (nombre, telefono, email, direccion) VALUES
('Juan Martínez', '611223344', 'juan.martinez@mail.com', 'Calle Gran Vía 45, Madrid'),
('María López', '622334455', 'maria.lopez@mail.com', 'Avenida Diagonal 123, Barcelona'),
('Carlos García', '633445566', 'carlos.garcia@mail.com', 'Plaza Mayor 7, Salamanca'),
('Ana Rodríguez', '644556677', 'ana.rodriguez@mail.com', 'Calle Sierpes 22, Sevilla'),
('David Fernández', '655667788', 'david.fernandez@mail.com', 'Paseo de la Castellana 89, Madrid'),
('Laura González', '666778899', 'laura.gonzalez@mail.com', 'Calle Colón 56, Valencia'),
('Javier Pérez', '677889900', 'javier.perez@mail.com', 'Gran Vía Marqués del Turia 5, Valencia'),
('Sofía Sánchez', '688990011', 'sofia.sanchez@mail.com', 'Calle Alfonso X 12, Murcia'),
('Daniel Romero', '699001122', 'daniel.romero@mail.com', 'Paseo del Espolón 34, Burgos'),
('Lucía Torres', '610112233', 'lucia.torres@mail.com', 'Calle Mayor 67, Zaragoza'),
('Alejandro Ruiz', '621334455', 'alejandro.ruiz@mail.com', 'Rambla Catalunya 102, Barcelona'),
('Elena Vargas', '632445566', 'elena.vargas@mail.com', 'Calle San Fernando 4, Sevilla'),
('Pablo Díaz', '643556677', 'pablo.diaz@mail.com', 'Calle de Alcalá 78, Madrid'),
('Carmen Jiménez', '654667788', 'carmen.jimenez@mail.com', 'Calle de la Estafeta 3, Pamplona'),
('Adrián Moreno', '665778899', 'adrian.moreno@mail.com', 'Calle de Serrano 112, Madrid'),
('Isabel Castro', '676889900', 'isabel.castro@mail.com', 'Calle de Preciados 24, Madrid'),
('Rubén Navarro', '687990011', 'ruben.navarro@mail.com', 'Calle de la Paz 9, Valladolid'),
('Patricia Domínguez', '698001122', 'patricia.dominguez@mail.com', 'Calle de Sagasta 15, Logroño'),
('Sergio Ramírez', '609112233', 'sergio.ramirez@mail.com', 'Calle de la Merced 33, Jerez'),
('Natalia Herrera', '620223344', 'natalia.herrera@mail.com', 'Calle de la Victoria 8, Málaga'),
('Miguel Ángel Santos', '631334455', 'miguel.santos@mail.com', 'Calle de la Libertad 45, Bilbao'),
('Raquel Medina', '642445566', 'raquel.medina@mail.com', 'Calle de la Cruz 19, Santander'),
('Óscar Cortés', '653556677', 'oscar.cortes@mail.com', 'Calle de San Pablo 56, Zaragoza'),
('Silvia Guerrero', '664667788', 'silvia.guerrero@mail.com', 'Calle de la Palma 23, Las Palmas'),
('Francisco Mora', '675778899', 'francisco.mora@mail.com', 'Calle de la Luna 12, Granada'),
('Beatriz León', '686889900', 'beatriz.leon@mail.com', 'Calle del Sol 34, Córdoba'),
('Álvaro Marín', '697990011', 'alvaro.marin@mail.com', 'Calle del Mar 7, Alicante'),
('Clara Rivas', '608001122', 'clara.rivas@mail.com', 'Calle de la Rosa 18, Murcia'),
('Jorge Campos', '619112233', 'jorge.campos@mail.com', 'Calle del Pilar 29, Valladolid'),
('Eva Vega', '630223344', 'eva.vega@mail.com', 'Calle de la Fuente 6, Oviedo'),
('Roberto Molina', '641334455', 'roberto.molina@mail.com', 'Calle del Carmen 41, Santander'),
('Cristina Pardo', '652445566', 'cristina.pardo@mail.com', 'Calle de la Estación 3, Gijón'),
('Víctor Cabrera', '663556677', 'victor.cabrera@mail.com', 'Calle del Río 14, Badajoz'),
('Teresa Gil', '674667788', 'teresa.gil@mail.com', 'Calle de la Iglesia 9, León'),
('Héctor Delgado', '685778899', 'hector.delgado@mail.com', 'Calle del Parque 22, Palencia'),
('Rosa Blanco', '696889900', 'rosa.blanco@mail.com', 'Calle de la Cruz 17, Ávila'),
('Fernando Vidal', '607990011', 'fernando.vidal@mail.com', 'Calle del Castillo 5, Segovia'),
('Lourdes Crespo', '618001122', 'lourdes.crespo@mail.com', 'Calle de la Vega 8, Toledo'),
('Iván Peña', '629112233', 'ivan.pena@mail.com', 'Calle del Prado 13, Cuenca'),
('Marina Robles', '640223344', 'marina.robles@mail.com', 'Calle de la Fuente 25, Guadalajara'),
('Ricardo Sáez', '651334455', 'ricardo.saez@mail.com', 'Calle de la Paz 32, Albacete'),
('Nuria Acosta', '662445566', 'nuria.acosta@mail.com', 'Calle del Sol 19, Ciudad Real'),
('Guillermo Benítez', '673556677', 'guillermo.benitez@mail.com', 'Calle de la Luna 7, Jaén'),
('Alicia Gallego', '684667788', 'alicia.gallego@mail.com', 'Calle del Río 4, Huelva'),
('Marcos Calvo', '695778899', 'marcos.calvo@mail.com', 'Calle de la Sierra 16, Cáceres'),
('Sara Menéndez', '606889900', 'sara.menendez@mail.com', 'Calle del Valle 9, Lugo'),
('Joaquín Rueda', '617990011', 'joaquin.rueda@mail.com', 'Calle de la Montaña 11, Ourense'),
('Verónica Lozano', '628001122', 'veronica.lozano@mail.com', 'Calle del Bosque 3, Pontevedra'),
('Gabriel Polo', '639112233', 'gabriel.polo@mail.com', 'Calle de la Playa 8, A Coruña'),
('Lidia Montes', '650223344', 'lidia.montes@mail.com', 'Calle del Puerto 14, Vigo'),
('Felipe Andrés', '661334455', 'felipe.andres@mail.com', 'Calle de la Bahía 6, Santander'),
('Olga Ferrer', '672445566', 'olga.ferrer@mail.com', 'Calle del Mirador 21, Girona'),
('Simón Carrasco', '683556677', 'simon.carrasco@mail.com', 'Calle de la Colina 9, Tarragona'),
('Ester Galán', '694667788', 'ester.galan@mail.com', 'Calle del Jardín 17, Lleida'),
('Raúl Pacheco', '605778899', 'raul.pacheco@mail.com', 'Calle de la Fuente 12, Huesca'),
('Inés Mateo', '616889900', 'ines.mateo@mail.com', 'Calle del Parque 5, Teruel'),
('Vicente Roldán', '627990011', 'vicente.roldan@mail.com', 'Calle de la Iglesia 8, Soria'),
('Lara Espinosa', '638001122', 'lara.espinosa@mail.com', 'Calle del Castillo 3, Zamora'),
('José María Arenas', '649112233', 'josemaria.arenas@mail.com', 'Calle del Río 19, Palencia');

-- Empleados
INSERT INTO Empleados (nombre, puesto, fecha_ingreso) VALUES
('Luis Miguel Blanco', 'Cuidador', '2020-05-15'),
('Sandra Milena Gómez', 'Administrador', '2019-11-20'),
('Antonio José Ruiz', 'Cuidador', '2021-02-10'),
('María del Carmen Pérez', 'Voluntario', '2022-03-05'),
('Francisco Javier Martín', 'Administrador', '2021-07-12'),
('Laura Isabel Sánchez', 'Cuidador', '2022-09-22'),
('Jorge Andrés Díaz', 'Voluntario', '2023-01-18'),
('Ana Belén García', 'Administrador', '2020-10-30'),
('David Alejandro López', 'Cuidador', '2021-04-05'),
('Elena Patricia Castro', 'Voluntario', '2023-02-10');

-- Veterinarios
INSERT INTO Veterinarios (nombre, colegiado, especialidad) VALUES
('Dra. Carolina Mendoza', 'VET-12345', 'Animales pequeños'),
('Dr. Roberto Jiménez', 'VET-23456', 'Cirugía'),
('Dra. Sofía Navarro', 'VET-34567', 'Rehabilitación'),
('Dr. Adrián Castillo', 'VET-45678', 'Animales exóticos'),
('Dra. Patricia Ríos', 'VET-56789', 'Dermatología');

-- Animales
DO $$
DECLARE
  perros TEXT[] := ARRAY['Bobby', 'Luna', 'Thor', 'Nala', 'Rocky', 'Duna', 'Toby', 'Maya', 'Leo', 'Lola'];
  gatos TEXT[] := ARRAY['Misi', 'Simba', 'Luna', 'Oliver', 'Milo', 'Loki', 'Cleo', 'Ginger', 'Shadow', 'Bella'];
  otros TEXT[] := ARRAY['Bugs', 'Cotton', 'Piolín', 'Shelly', 'Nibbles', 'Flash', 'Slinky', 'Whiskers', 'Fuzzy', 'Pip'];
  saludes TEXT[] := ARRAY['Buena', 'Regular', 'Crítica'];
  especie_record RECORD;
  nombre_animal TEXT;
  fecha_ingreso_val DATE;
BEGIN
  FOR especie_record IN SELECT id, nombre FROM Especies LOOP
    FOR i IN 1..6 LOOP  -- 6 animals per species
      -- Assign species-appropriate name
      IF especie_record.nombre = 'Perro' THEN
        nombre_animal := perros[1 + (random() * (array_length(perros, 1) - 1))::INT];
      ELSIF especie_record.nombre = 'Gato' THEN
        nombre_animal := gatos[1 + (random() * (array_length(gatos, 1) - 1))::INT];
      ELSE
        nombre_animal := otros[1 + (random() * (array_length(otros, 1) - 1))::INT];
      END IF;
      
      -- Generate unique date for each animal
      fecha_ingreso_val := CURRENT_DATE - (random() * 365)::INT * INTERVAL '1 day';
      
      -- Insert with conflict handling
      INSERT INTO Animales (nombre, especie_id, edad, fecha_ingreso, salud)
      VALUES (
        nombre_animal,
        especie_record.id,
        (random() * 15)::INT,
        fecha_ingreso_val,
        saludes[1 + (random() * 2)::INT]
      )
      ON CONFLICT (nombre, fecha_ingreso) DO UPDATE 
      SET nombre = EXCLUDED.nombre || ' ' || (random() * 100)::INT;
    END LOOP;
  END LOOP;
END $$;

-- Adopciones (30 adoptions) - FIXED
DO $$
DECLARE
  animales_ids INT[];
  personas_ids INT[];
  animal_id INT;
  animal_fecha_ingreso DATE;
  fecha_adopcion DATE;
  days_diff INT;
BEGIN
  -- Get first 40 animals (some will be adopted)
  SELECT array_agg(id) INTO animales_ids FROM (
    SELECT id FROM Animales ORDER BY id LIMIT 40
  ) subq;
  
  -- Get first 40 people (potential adopters)
  SELECT array_agg(id) INTO personas_ids FROM (
    SELECT id FROM Personas ORDER BY id LIMIT 40
  ) subq;
  
  -- Create adoptions for about 30 animals
  FOR i IN 1..30 LOOP
    -- Get the animal's ID and intake date
    SELECT a.id, a.fecha_ingreso INTO animal_id, animal_fecha_ingreso 
    FROM Animales a 
    WHERE a.id = animales_ids[i];
    
    -- Calculate random days difference (1 to max possible)
    days_diff := 1 + (random() * (CURRENT_DATE - animal_fecha_ingreso))::INT;
    
    -- Calculate adoption date
    fecha_adopcion := animal_fecha_ingreso + (days_diff * INTERVAL '1 day');
    
    INSERT INTO Adopciones (animal_id, persona_id, fecha_adopcion, aprobado_por)
    VALUES (
      animal_id,
      personas_ids[i],
      fecha_adopcion,
      (1 + (random() * 9))::INT  -- Random employee (1-10)
    );
    
    -- Mark animal as adopted
    UPDATE Animales SET adoptado = TRUE WHERE id = animal_id;
  END LOOP;
END $$;

-- Tratamientos (2-4 treatments per animal with health issues)
DO $$
DECLARE
  animal RECORD;
  num_tratamientos INT;
BEGIN
  FOR animal IN SELECT id FROM Animales WHERE salud IN ('Regular', 'Crítica') LOOP
    num_tratamientos := 2 + (random() * 2)::INT;  -- 2-4 treatments
    
    FOR i IN 1..num_tratamientos LOOP
      INSERT INTO Tratamientos (animal_id, veterinario_id, descripcion, fecha, costo)
      VALUES (
        animal.id,
        1 + (random() * 4)::INT,  -- Random vet (1-5)
        CASE 
          WHEN i = 1 THEN 'Consulta inicial y diagnóstico'
          WHEN i = 2 THEN 'Tratamiento principal'
          WHEN i = 3 THEN 'Seguimiento y control'
          ELSE 'Tratamiento adicional'
        END || ' - ' ||
        CASE 
          WHEN random() < 0.3 THEN 'Vacunación'
          WHEN random() < 0.6 THEN 'Desparasitación'
          ELSE 'Chequeo general'
        END,
        CURRENT_DATE - (random() * 90)::INT * INTERVAL '1 day',
        CASE 
          WHEN i = 1 THEN 50 + (random() * 50)::NUMERIC(8,2)
          WHEN i = 2 THEN 80 + (random() * 120)::NUMERIC(8,2)
          ELSE 30 + (random() * 70)::NUMERIC(8,2)
        END
      );
    END LOOP;
  END LOOP;
END $$;
